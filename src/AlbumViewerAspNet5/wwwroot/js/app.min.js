!function(){"use strict";var t=angular.module("app",["ngAnimate","ngRoute","ngSanitize","ngAria"]);t.configuration={useLocalData:!1},t.config(["$routeProvider",function(t){t.when("/albums",{templateUrl:"app/views/albums.html"}).when("/album/edit/:albumId",{templateUrl:"app/views/editalbum.html"}).when("/album/:albumId",{templateUrl:"app/views/album.html"}).when("/artists",{templateUrl:"app/views/artists.html"}).when("/artist/:artistId",{templateUrl:"app/views/artist.html"}).when("/about",{templateUrl:"app/views/about.html"}).otherwise({redirectTo:"/albums"})}]).filter("linebreakFilter",function(){return function(t){return void 0!==t?t.replace(/\n/g,"<br />"):t}})}(),function(){"use strict";function t(t,r,e,a){var n=this;n.album=null,n.selectedArtist={ArtistName:null,Description:null},n.error={message:null,icon:"warning",reset:function(){n.error={message:"",icon:"warning"}}},n.isSongVisible=!1,n.song={Id:0,AlbumId:0,Name:null,Length:null},n.saveAlbum=function(t){console.log(t),a.saveAlbum(t).success(function(t){n.error.message="Album saved",n.error.icon="info",setTimeout(function(){r.location.hash="/album/"+t.Id},1e3)}).error(function(){n.error.message="Album saved",n.error.icon="warning"})},n.addSong=function(){n.isSongVisible=!0,n.song={Id:0,AlbumId:a.album.Id,Name:null,Length:null},setTimeout(function(){$("#SongName").focus()},300)},n.saveSong=function(t){a.addSongToAlbum(n.album,t),n.albums=a.albums,n.album=a.album,n.isSongVisible=!1},n.cancelSong=function(){n.isSongVisible=!1},n.removeSong=function(t){console.log(t),a.removeSong(n.album,t),n.album=a.album},n.deleteAlbum=function(t){confirm("Are you sure you want to delete this album?")&&a.deleteAlbum(t).success(function(){n.albums=a.albums,$location.path("#/albums")}).error(onPageError)},n.getAlbum=function(t){a.getAlbum(t,!0).success(function(t){n.album=t})},n.bandTypeAhead=function(){var t=$("#BandName");t.typeahead({source:[],autoselect:!0}),t.keyup(function(){var r=$(this).val();$.getJSON("../api/artistlookup?search="+r,function(r){console.log(r),t.data("typeahead").source=r})})},n.getAlbum(1*t.albumId,!0),n.bandTypeAhead(),e.addClass("#MainView","slide-animation")}var r=angular.module("app").controller("albumController",t);t.$inject=r.configuration.useLocalData?["$routeParams","$window","$animate","albumServiceLocal"]:["$routeParams","$window","$animate","albumService"]}(),function(){"use strict";function t(t,r){function e(){return{Id:0,ArtistId:0,Tracks:[],Artist:{Id:0,ArtistName:null},Title:null,AmazonUrl:null,ImageUrl:null}}function a(){return{Id:0,SongName:null,Length:null}}function n(e){return!e&&b.albums&&b.albums.length>0?ww.angular.$httpPromiseFromValue(r,b.albums):t.get(b.baseUrl+"albums/").success(function(t){b.albums=t}).error(onPageError)}function u(e,a){if(0===e||"0"===e)return b.album=b.newAlbum(),ww.angular.$httpPromiseFromValue(r,b.album);if(-1===e||"-1"===e||!e)return ww.angular.$httpPromiseFromValue(r,b.album);if(b.album&&a&&b.album.pk==e){var n=ww.angular.deferredExtender(r.defer());return n.resolve(b.album),n.promise}return t.get(b.baseUrl+"album/"+e).success(function(t){b.album=t}).error(function(t,r,e,a){console.log(t,a)})}function s(t,r){t.Tracks.push(r),b.album=t}function l(t,r){var e=m(t);if(-1!=e){var a=b.albums[e];a.Tracks=_.remove(a.Tracks,function(t){return t.Id!=r.Id}),b.album=a}}function i(t){var r=m(t);r>-1?b.albums[r]=t:(b.albums.push(t),b.albums=_.remove(b.albums,function(){return 0==t.Id})),b.album=t}function o(r){return t.post(b.baseUrl+"album",r).success(function(t){b.updateAlbum(t),b.album=t})}function c(r){return t.get(b.baseUrl+"deletealbum/"+r.Id).success(function(){b.albums=_.remove(b.albums,function(t){return r.Id!=t.Id})})}function m(t){return _.findIndex(b.albums,function(r){return t.Id==r.Id})}var b={baseUrl:"api/",albums:[],artists:[],album:e(),getAlbums:n,getAlbum:u,updateAlbum:i,saveAlbum:o,deleteAlbum:c,addSongToAlbum:s,removeSong:l,newAlbum:e,newSong:a,activeTab:"albums"};return b}angular.module("app").factory("albumService",t),t.$inject=["$http","$q"]}(),function(){"use strict";function t(t,r){function e(){return{Id:0,ArtistId:0,Tracks:[],Artist:{Id:0,ArtistName:null},Title:null,AmazonUrl:null,ImageUrl:null}}function a(){return{Id:0,SongName:null,Length:null}}function n(e){return e=e||0,!e&&f.albums&&f.albums.length>0?ww.angular.$httpPromiseFromValue(r,f.albums):2!=e&&(f.albums=localStorage.getItem("av_albums"),f.albums&&f.albums.length>0)?ww.angular.$httpPromiseFromValue(r,JSON.parse(f.albums)):t.get(f.baseUrl+"albums.js").success(function(t){f.albums=t}).error(onPageError)}function u(t,e){if(0===t||"0"===t)return f.album=f.newAlbum(),ww.angular.$httpPromiseFromValue(r,f.album);if(-1===t||"-1"===t||!t)return ww.angular.$httpPromiseFromValue(r,f.album);if(f.album&&e&&f.album.pk==t)return ww.angular.$httpPromiseFromValue(r,f.album);if(f.albums&&f.albums.length>0){var a=b(t);if(!a)return ww.angular.$httpPromiseFromValue(r,new Error("Couldn't find album"),!0)}var n=ww.angular.$httpDeferredExtender(r.defer());return f.getAlbums().success(function(){f.album=b(t),f.album?n.resolve(f.album):n.reject(new Error("Couldn't find album"))}).error(function(){n.reject(new Error("Couldn't find album"))}),n.promise}function s(t,r){t.Tracks.push(r),f.album=t}function l(t,r){var e=m(t);if(-1!=e){var a=f.albums[e];a.Tracks=_.remove(a.Tracks,function(t){return t.Id!=r.Id}),f.album=a}}function i(t){var r=m(t);r>-1?f.albums[r]=t:(f.albums.push(t),f.albums=_.remove(f.albums,function(){return 0==t.Id})),f.album=t}function o(r){return t.post(f.baseUrl+"album",r).success(function(t){f.updateAlbum(t),f.album=t})}function c(r){return t.get(f.baseUrl+"deletealbum/"+r.Id).success(function(){f.albums=_.remove(f.albums,function(t){return r.Id!=t.Id})})}function m(t){return _.findIndex(f.albums,function(r){return t.Id==r.Id})}function b(t){return _.find(f.albums,function(r){return t===r.Id})}var f={baseUrl:"data/",albums:[],artists:[],album:e(),getAlbums:n,getAlbum:u,updateAlbum:i,saveAlbum:o,deleteAlbum:c,addSongToAlbum:s,removeSong:l,newAlbum:e,newSong:a,activeTab:"albums"};return f}angular.module("app").factory("albumServiceLocal",t),t.$inject=["$http","$q"]}(),function(){"use strict";function t(t,r){var e=this;e.albums=null,e.error={message:null,icon:"warning",reset:function(){e.error={message:"",icon:"warning"}}},e.searchText="",e.artistpk=0,e.albumClick=function(t){window.location="#/album/"+t.Id},e.getAlbums=function(){r.getAlbums().success(function(t){e.albums=t}).error(function(){alert("failed to get albums")})},e.addAlbum=function(){r.album=r.newAlbum(),r.updateAlbum(r.album),window.location="#/album/edit/"+r.album.Id},e.deleteAlbum=function(t){confirm("Are you sure you want to delete this album?")&&r.deleteAlbum(t).success(function(){e.albums=r.albums}).error(onPageError)},e.albumsFilter=function(t){var r=e.searchText.toLowerCase();return t&&t.Title&&(t.Title.toLowerCase().indexOf(r)>-1||t.Artist.ArtistName.toLowerCase().indexOf(r)>-1)?!0:!1},t.$root.$on("onsearchkey",function(t,r){e.searchText=r}),e.getAlbums()}var r=angular.module("app").controller("albumsController",t);t.$inject=r.configuration.useLocalData?["$scope","albumServiceLocal"]:["$scope","albumService"]}(),function(){"use strict";function t(t,r,e,a,n){var u=this;u.artist=null,u.baseUrl="api/",u.albums=[],u.error={message:null,icon:"warning",reset:function(){u.error={message:"",icon:"warning"}},show:function(t,r){u.error.message=t,u.error.icon=r?r:"warning"}},u.getArtist=function(t){n.getArtist(t).success(function(t){u.artist=t.Artist,u.albums=t.Albums}).error(function(){u.error.show("Artist couldn't be loaded.","warning")})},u.saveArtist=function(t){n.saveArtist(t).success(function(t){u.artist=t.Artist,u.albums=t.Albums,$("#EditModal").modal("hide")}).error(function(){u.error.show("Artist couldn't be saved.","warning")})},u.albumClick=function(t){r.location.hash="/album/"+t.Id},u.addAlbum=function(){albumService.album=albumService.newAlbum(),albumService.album.ArtistId=u.artist.Id,albumService.album.Artist.Id=u.artist.Id,albumService.album.Artist.ArtistName=u.artist.ArtistName,albumService.updateAlbum(albumService.album),r.location.hash="/album/edit/0"},u.getArtist(e.artistId),a.addClass("#MainView","slide-animation")}var r=angular.module("app").controller("artistController",t);t.$inject=r.configuration.useLocalData?["$http","$window","$routeParams","$animate","artistServiceLocal"]:["$http","$window","$routeParams","$animate","artistService"]}(),function(){"use strict";function t(t,r){function e(){return{Id:0,ArtistName:null,AmazonUrl:null,AlbumCount:0}}function a(e){return!e&&c.artists&&c.artists.length>0?ww.angular.$httpPromiseFromValue(r,c.artists):t.get(c.baseUrl+"artists").success(function(t){c.artists=t}).error(onPageError)}function n(e,a){if(0===e||"0"===e)return c.artist=c.newArtist(),ww.angular.$httpPromiseFromValue(r,c.album);if(-1===e||"-1"===e||!e)return ww.angular.$httpPromiseFromValue(r,c.album);if(c.artist&&a&&c.artist.id==e)return ww.angular.$httpPromiseFromValue(r,c.artist);if(c.artists&&c.artists.length>0){var n=o(e);if(!n)return ww.angular.$httpPromiseFromValue(r,new Error("Couldn't find artist"),!0)}return t.get(c.baseUrl+"artist/"+e).success(function(t){c.artist=t.Artist,c.albums=t.Albums})}function u(t){var r=i(t);r>-1?c.artists[r]=t:(c.artists.push(t),c.artists=_.remove(c.artists,function(t){return 0===t.Id})),c.artist=t}function s(r){return t.post(c.baseUrl+"artist/",r).success(function(t){c.artist=t.Artist,c.albums=t.Albums,u(t.Artist)}).error(function(){c.error="Artist couldn't be saved."}),t.post(c.baseUrl+"artist",r).success(function(t){c.updateArtist(t),c.artist=t})}function l(r){return t.get(c.baseUrl+"deletealbum/"+r.Id).success(function(){c.albums=_.remove(c.albums,function(t){return r.Id!=t.Id})})}function i(t){return _.findIndex(c.artists,function(r){return"Object"==typeof t?t.Id==r.Id:t==r.Id})}function o(t){t=1*t;var r=_.find(c.artists,function(r){return console.log(t,r.Id),t===r.Id});return r}var c={baseUrl:"api/",artist:e(),artists:[],albums:[],getArtists:a,getArtist:n,saveArtist:s,updateArtist:u,deleteArtist:l,newArtist:e};return c}angular.module("app").factory("artistService",t),t.$inject=["$http","$q"]}(),function(){"use strict";function t(t,r){function e(){return{Id:0,ArtistName:null,AmazonUrl:null,AlbumCount:0}}function a(e){return!e&&o.artists&&o.artists.length>0?ww.angular.$httpPromiseFromValue(r,o.artists):t.get(o.baseUrl+"artists.js").success(function(t){o.artists=t}).error(onPageError)}function n(t,e){if(0===t||"0"===t)return o.artist=o.newArtist(),ww.angular.$httpPromiseFromValue(r,o.album);if(-1===t||"-1"===t||!t)return ww.angular.$httpPromiseFromValue(r,o.album);if(o.artist&&e&&o.artist.id==t)return ww.angular.$httpPromiseFromValue(r,o.artist);if(o.artists&&o.artists.length>0){var a=i(t);if(!a)return ww.angular.$httpPromiseFromValue(r,new Error("Couldn't find artist"),!0)}var n=ww.angular.$httpDeferredExtender(r.defer());return o.getArtists().success(function(){o.artist=i(t),o.artist?n.resolve(o.artist):n.reject(new Error("Couldn't find artist"))}).error(function(){n.reject(new Error("Couldn't find artist"))}),n.promise}function u(t){var r=findAlbumIndex(t);r>-1?o.albums[r]=album:(o.albums.push(album),o.albums=_.remove(o.albums,function(){return 0==album.Id})),o.album=album}function s(){return t.post(o.baseUrl+"album",album).success(function(t){o.updateAlbum(t),o.album=t})}function l(r){return t.get(o.baseUrl+"deletealbum/"+r.Id).success(function(){o.albums=_.remove(o.albums,function(t){return r.Id!=t.Id})})}function i(t){t=1*t;var r=_.find(o.artists,function(r){return console.log(t,r.Id),t===r.Id});return r}var o={baseUrl:"data/",artist:e(),artists:[],getArtists:a,getArtist:n,updateAlbum:u,saveAlbum:s,deleteArtist:l,newArtist:e};return o}angular.module("app").factory("artistServiceLocal",t),t.$inject=["$http","$q"]}(),function(){"use strict";function t(t,r,e){console.log("artists controller");var a=this;a.artists=[],a.searchText="",a.baseUrl="data/",a.getArtists=function(){return e.getArtists().success(function(t){a.artists=t})},t.$root.$on("onsearchkey",function(t,r){a.searchText=r}),a.getArtists()}var r=angular.module("app").controller("artistsController",t);t.$inject=r.configuration.useLocalData?["$scope","$http","artistServiceLocal"]:["$scope","$http","artistService"]}(),function(){"use strict";function t(t,r,e,a){function n(t){var t=t.toLowerCase();u.searchAllowed="albums"==t||"artists"==t?!0:!1,console.log(u.searchAllowed)}console.log("header controller");var u=t;u.searchText="",u.searchAllowed=!1,u.searchVisible=!1,u.activeTab=a.activeTab,u.onKey=function(){t.$emit("onsearchkey",u.searchText)},u.showSearch=function(){u.searchVisible=!0,$("#SearchBox").show(),setTimeout(function(){$("#SearchBox").focus()},5)},u.hideSearch=function(){u.searchVisible=!1,$("#SearchBox").hide()},t.searchBlur=function(){u.searchText="",u.hideSearch()},u.$on("$locationChangeSuccess",function(){var t=e.location.hash;u.activeTab=t.extract("#/","/",!0),n(u.activeTab),console.log(t,u.activeTab)})}angular.module("app").controller("headerController",t),t.$inject=["$scope","$route","$window","albumServiceLocal"]}();
//# sourceMappingURL=app.min.js.map